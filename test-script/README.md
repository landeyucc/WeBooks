# æ•°æ®åº“ç®¡ç†è„šæœ¬è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜é¡¹ç›®ä¸­çš„æ•°æ®åº“ç®¡ç†ç›¸å…³è„šæœ¬åŠå…¶ä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### ğŸ” æ£€æŸ¥å’ŒçŠ¶æ€ç±»

#### `check-db-status.js` - æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
```bash
node test-script/check-db-status.js
```
**åŠŸèƒ½**: æ£€æŸ¥æ•°æ®åº“ä¸­å„ç±»æ•°æ®çš„æ•°é‡å’ŒçŠ¶æ€ï¼Œæä¾›è¯¦ç»†çš„æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯ã€‚

#### `check-db.js` - ç®€å•æ•°æ®åº“æ£€æŸ¥
```bash
node test-script/check-db.js
```
**åŠŸèƒ½**: å¿«é€Ÿæ£€æŸ¥ç”¨æˆ·å’Œç©ºé—´æ•°æ®ã€‚

### ğŸ”„ é‡ç½®å’Œæ¸…ç†ç±»

#### `reset-database.js` - å®‰å…¨æ•°æ®åº“é‡ç½®
```bash
node test-script/reset-database.js
```
**åŠŸèƒ½**: å®‰å…¨åœ°æ¸…ç©ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®
- æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ç¡®è®¤æ“ä½œ
- æŒ‰å¤–é”®çº¦æŸé¡ºåºåˆ é™¤æ•°æ®ï¼ˆé¿å…ä¾èµ–é”™è¯¯ï¼‰
- æä¾›é‡ç½®ç»Ÿè®¡ä¿¡æ¯
- ä¸ä¼šé‡å»ºæ•°æ®åº“ç»“æ„

#### `hard-reset-database.js` - å®Œå…¨é‡ç½®æ•°æ®åº“
```bash
node test-script/hard-reset-database.js
```
**åŠŸèƒ½**: è¿›è¡Œæ•°æ®åº“çš„å®Œå…¨é‡ç½®
- åˆ é™¤æ‰€æœ‰æ•°æ®
- é‡æ–°åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- éªŒè¯é‡ç½®ç»“æœ
- é€‚ç”¨äºæ•°æ®åº“ç»“æ„æŸåçš„æƒ…å†µ

### ğŸ‘¤ ç”¨æˆ·ç®¡ç†ç±»

#### `create-admin.js` - åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
```bash
node test-script/create-admin.js
```
**åŠŸèƒ½**: åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼ˆç”¨æˆ·å: admin, å¯†ç : admin123ï¼‰

#### `reset-admin.js` - é‡ç½®ç®¡ç†å‘˜å¯†ç 
```bash
node test-script/reset-admin.js
```
**åŠŸèƒ½**: åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·

#### `verify-admin.js` - éªŒè¯ç®¡ç†å‘˜ç”¨æˆ·
```bash
node test-script/verify-admin.js
```
**åŠŸèƒ½**: æ£€æŸ¥æ•°æ®åº“ä¸­çš„ç®¡ç†å‘˜ç”¨æˆ·ä¿¡æ¯

#### `check-and-fix-user.js` - å®Œæ•´ç”¨æˆ·å’Œç¤ºä¾‹æ•°æ®åˆ›å»º
```bash
node test-script/check-and-fix-user.js
```
**åŠŸèƒ½**: åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·å’Œå®Œæ•´çš„ç¤ºä¾‹æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
- ç®¡ç†å‘˜ç”¨æˆ·
- å·¥ä½œç©ºé—´
- ç³»ç»Ÿé…ç½®
- JWT Token ç”Ÿæˆ

### ğŸ”„ æ•°æ®åŒæ­¥ç±»

#### `sync-user-data.js` - ç”¨æˆ·æ•°æ®åŒæ­¥
```bash
node test-script/sync-user-data.js
```
**åŠŸèƒ½**: åŒæ­¥ç”¨æˆ·æ•°æ®ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

#### `get-default-user.js` - è·å–é»˜è®¤ç”¨æˆ·
```bash
node test-script/get-default-user.js
```
**åŠŸèƒ½**: æŸ¥è¯¢æ•°æ®åº“ä¸­çš„é»˜è®¤ç”¨æˆ·ID

## ğŸš€ å¿«é€Ÿå¼€å§‹æŒ‡å—

### 1. åˆå§‹åŒ–æ•°æ®åº“
```bash
# åˆå§‹åŒ–æ•°æ®åº“ç»“æ„
npx prisma db push

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
node test-script/check-db-status.js
```

### 2. åˆ›å»ºæµ‹è¯•æ•°æ®
```bash
# æ–¹æ³•1: å¿«é€Ÿåˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
node test-script/create-admin.js

# æ–¹æ³•2: åˆ›å»ºå®Œæ•´ç¤ºä¾‹æ•°æ®ï¼ˆæ¨èï¼‰
node test-script/check-and-fix-user.js
```

### 3. æ£€æŸ¥æ•°æ®çŠ¶æ€
```bash
# æ£€æŸ¥æ‰€æœ‰è¡¨çš„æ•°æ®çŠ¶æ€
node test-script/check-db-status.js

# å¿«é€Ÿæ£€æŸ¥ç”¨æˆ·å’Œç©ºé—´
node test-script/check-db.js
```

### 4. é‡ç½®æ•°æ®åº“ï¼ˆéœ€è¦æ—¶ï¼‰
```bash
# å®‰å…¨é‡ç½®ï¼šåªæ¸…ç©ºæ•°æ®
node test-script/reset-database.js

# å®Œå…¨é‡ç½®ï¼šé‡å»ºæ•°æ®ç»“æ„å’Œæ•°æ®
node test-script/hard-reset-database.js
```

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

| è¡¨å | ç”¨é€” | å…³è”å…³ç³» |
|------|------|----------|
| users | ç”¨æˆ·ä¿¡æ¯ | ä¸»è¡¨ï¼Œæ‰€æœ‰å…¶ä»–è¡¨çš„çˆ¶è¡¨ |
| spaces | ç”¨æˆ·å·¥ä½œç©ºé—´ | å…³è”åˆ° users |
| folders | æ–‡ä»¶å¤¹ | å…³è”åˆ° users å’Œ spaces |
| bookmarks | ä¹¦ç­¾ | å…³è”åˆ° usersã€spacesã€folders |
| system_configs | ç³»ç»Ÿé…ç½® | å…³è”åˆ° users |

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®‰å…¨è­¦å‘Š**: é‡ç½®æ•°æ®åº“è„šæœ¬ä¼šæ°¸ä¹…åˆ é™¤æ•°æ®ï¼Œæ“ä½œå‰è¯·ç¡®è®¤
2. **æ•°æ®åº“è¿æ¥**: ç¡®ä¿ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL` é…ç½®æ­£ç¡®
3. **æ‰§è¡Œé¡ºåº**: æŸäº›è„šæœ¬æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¯·æŒ‰ç…§æ¨èé¡ºåºæ‰§è¡Œ
4. **ç¯å¢ƒå˜é‡**: æŸäº›è„šæœ¬ä¼šä½¿ç”¨ `.env` æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå¦‚ `JWT_SECRET`

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. `table does not exist` é”™è¯¯
**åŸå› **: æ•°æ®åº“è¡¨ç»“æ„æœªåˆå§‹åŒ–
**è§£å†³**: 
```bash
npx prisma db push
```

#### 2. `P1001` è¿æ¥é”™è¯¯
**åŸå› **: æ•°æ®åº“è¿æ¥é…ç½®é”™è¯¯æˆ–æœåŠ¡æœªå¯åŠ¨
**è§£å†³**: 
- æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `DATABASE_URL`
- ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ

#### 3. `prisma.$disconnect()` é”™è¯¯
**åŸå› **: æ•°æ®åº“è¿æ¥å¼‚å¸¸
**è§£å†³**: é‡æ–°è¿è¡Œè„šæœ¬ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†è¿æ¥æ–­å¼€

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®åº“è¿æ¥é…ç½®
2. ç½‘ç»œè¿æ¥çŠ¶æ€
3. æ•°æ®åº“æœåŠ¡è¿è¡ŒçŠ¶æ€
4. ç¯å¢ƒå˜é‡é…ç½®